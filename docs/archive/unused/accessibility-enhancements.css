/* Enhanced Accessibility CSS for Font Implementation
 * Supplements existing chat.css with advanced accessibility features
 * Focus: iOS Dynamic Type, high contrast, and screen reader optimization
 */

/* WCAG 2.1 AAA Enhanced Contrast Support */
@media (prefers-contrast: high) {
    :root {
        /* Enhanced opacity for better text visibility */
        --glass-opacity-base: 0.4;
        --glass-border-opacity: 0.8;

        /* Higher contrast text colors */
        --text-primary-enhanced: #000000;
        --text-secondary-enhanced: #2c2c2c;
        --text-accent-enhanced: #1a365d;
    }

    /* High contrast text implementations */
    .chat-input,
    .message,
    .chat-header-title {
        color: var(--text-primary-enhanced) !important;
        font-weight: 600 !important;
        text-shadow: 0 1px 2px rgba(255, 255, 255, 0.8) !important;
    }

    /* Enhanced borders for better definition */
    .chat-container,
    .message,
    .chat-input {
        border-width: 2px !important;
        border-color: var(--text-primary-enhanced) !important;
    }

    /* High contrast glassmorphic adjustments */
    .chat-container {
        background: rgba(255, 255, 255, 0.95) !important;
        backdrop-filter: none !important;
    }

    .message.user {
        background: rgba(240, 240, 255, 0.95) !important;
    }

    .message.bot {
        background: rgba(255, 240, 240, 0.95) !important;
    }
}

/* Advanced Dynamic Type Support */
@supports (font-size: 1rem) {
    :root {
        /* Dynamic Type CSS variables */
        --dynamic-type-scale: 1;
        --min-font-size-input: 16px;
        --min-font-size-content: 14px;
        --min-font-size-ui: 12px;
        --min-touch-target: 44px;

        /* Responsive font sizing with minimums */
        --font-size-input: max(var(--min-font-size-input), calc(1rem * var(--dynamic-type-scale)));
        --font-size-content: max(var(--min-font-size-content), calc(0.875rem * var(--dynamic-type-scale)));
        --font-size-ui: max(var(--min-font-size-ui), calc(0.75rem * var(--dynamic-type-scale)));

        /* Dynamic line heights for readability */
        --line-height-input: calc(1.4 + (var(--dynamic-type-scale) - 1) * 0.2);
        --line-height-content: calc(1.5 + (var(--dynamic-type-scale) - 1) * 0.3);
        --line-height-ui: calc(1.3 + (var(--dynamic-type-scale) - 1) * 0.2);
    }

    /* Apply dynamic sizing to key elements */
    .chat-input {
        font-size: var(--font-size-input) !important;
        line-height: var(--line-height-input) !important;
        /* Ensure padding scales with text size */
        padding: calc(12px * var(--dynamic-type-scale)) calc(56px * var(--dynamic-type-scale)) calc(12px * var(--dynamic-type-scale)) calc(16px * var(--dynamic-type-scale)) !important;
    }

    .message {
        font-size: var(--font-size-content) !important;
        line-height: var(--line-height-content) !important;
        /* Scale padding proportionally */
        padding: calc(12px * var(--dynamic-type-scale)) calc(16px * var(--dynamic-type-scale)) !important;
    }

    .chip,
    .chat-header-title {
        font-size: var(--font-size-ui) !important;
        line-height: var(--line-height-ui) !important;
    }
}

/* Large Text Mode Optimizations (iOS Accessibility) */
@media (min-resolution: 2dppx) and (max-width: 768px) {
    /* Optimize for high-DPI mobile displays with large text */
    .chat-input,
    .message {
        -webkit-font-smoothing: subpixel-antialiased;
        font-variant-numeric: oldstyle-nums tabular-nums;
    }

    /* Increased spacing for large text readability */
    .message {
        margin-bottom: calc(18px * var(--dynamic-type-scale, 1));
        word-spacing: 0.1em;
        letter-spacing: 0.02em;
    }

    /* Enhanced touch targets for large text users */
    .chat-send,
    .header-dot,
    .theme-toggle {
        min-width: calc(var(--min-touch-target) * var(--dynamic-type-scale, 1)) !important;
        min-height: calc(var(--min-touch-target) * var(--dynamic-type-scale, 1)) !important;
    }
}

/* Screen Reader Optimized Font Properties */
.sr-optimized {
    /* Fonts that work well with screen readers */
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Roboto", sans-serif !important;
    font-variant-ligatures: none !important; /* Prevent ligature confusion */
    font-feature-settings: "kern" 1, "liga" 0 !important; /* Kerning yes, ligatures no */
    word-spacing: normal !important;
    letter-spacing: normal !important;
}

/* Apply screen reader optimization to interactive elements */
.chat-input,
.message,
input[type="text"],
button {
    @extend .sr-optimized;
}

/* Focus Management with Font Considerations */
.chat-container:focus-within {
    /* Ensure focus states don't interfere with font rendering */
    outline: 3px solid #4A90E2;
    outline-offset: 2px;
}

.chat-input:focus {
    /* Enhanced focus state for accessibility */
    font-weight: 500 !important;
    text-shadow: none !important; /* Clear text shadow for better focus readability */
    color: #000000 !important;
    background: rgba(255, 255, 255, 0.98) !important;
}

/* Keyboard Navigation Font Adjustments */
.keyboard-user *:focus {
    /* Enhanced visibility for keyboard navigation */
    outline: 2px solid #4A90E2 !important;
    outline-offset: 2px !important;
    box-shadow: 0 0 0 4px rgba(74, 144, 226, 0.2) !important;
}

.keyboard-user .chat-input:focus {
    /* High visibility input focus for keyboard users */
    border-color: #4A90E2 !important;
    background: #ffffff !important;
    color: #000000 !important;
    font-weight: 600 !important;
}

/* iOS VoiceOver Optimizations */
@supports (-webkit-touch-callout: none) {
    .message[aria-label],
    .chat-input[aria-label] {
        /* Optimize font rendering for VoiceOver reading */
        speak: normal;
        speak-punctuation: code;
        speak-numeral: digits;

        /* Ensure clear pronunciation boundaries */
        word-spacing: 0.05em;
        font-variant-numeric: tabular-nums;
    }

    /* VoiceOver hint text styling */
    .visually-hidden {
        /* Screen reader only content with optimal font stack */
        font-family: -apple-system, BlinkMacSystemFont, sans-serif !important;
        font-size: 16px !important; /* Standard size for SR processing */
        font-weight: 400 !important;
        line-height: 1.4 !important;
    }
}

/* Motion Reduction with Font Stability */
@media (prefers-reduced-motion: reduce) {
    /* Ensure font changes are immediate, not animated */
    .chat-input,
    .message,
    .chat-container * {
        transition: color 0s, font-size 0s, font-weight 0s !important;
        animation: none !important;
    }

    /* Stable font rendering for motion-sensitive users */
    .message {
        transform: none !important;
    }

    .chat-input:focus {
        transform: none !important;
        animation: none !important;
    }
}

/* Dark Mode Accessibility Enhancements */
@media (prefers-color-scheme: dark) {
    :root {
        /* Enhanced dark mode contrast ratios */
        --text-primary-dark: rgba(255, 255, 255, 0.98);
        --text-secondary-dark: rgba(255, 255, 255, 0.85);
        --text-accent-dark: rgba(135, 206, 250, 0.95);
    }

    .chat-input {
        color: var(--text-primary-dark) !important;
        /* Enhanced text shadow for dark glass backgrounds */
        text-shadow:
            0 1px 2px rgba(0, 0, 0, 0.9),
            0 0 1px rgba(0, 0, 0, 0.7) !important;
        font-weight: 500 !important;
    }

    .message {
        color: var(--text-primary-dark) !important;
        text-shadow:
            0 1px 1px rgba(0, 0, 0, 0.8),
            0 0 1px rgba(0, 0, 0, 0.6) !important;
    }

    /* High contrast dark mode */
    @media (prefers-contrast: high) {
        .chat-input,
        .message {
            color: #ffffff !important;
            background: rgba(0, 0, 0, 0.9) !important;
            border-color: #ffffff !important;
            text-shadow: none !important;
            font-weight: 700 !important;
        }
    }
}

/* Print Accessibility */
@media print {
    /* Ensure fonts are readable when printed */
    .chat-container,
    .message,
    .chat-input {
        font-family: "Times New Roman", serif !important;
        font-size: 12pt !important;
        line-height: 1.4 !important;
        color: #000000 !important;
        background: transparent !important;
        text-shadow: none !important;
    }

    .message {
        border: 1px solid #000000 !important;
        margin-bottom: 6pt !important;
        padding: 6pt !important;
    }
}

/* Browser-Specific Font Optimizations */

/* Safari-specific optimizations */
@supports (-webkit-hyphens: auto) {
    .message,
    .chat-input {
        -webkit-hyphenate-limit-before: 3;
        -webkit-hyphenate-limit-after: 3;
        -webkit-hyphenate-limit-lines: 2;
        -webkit-hyphens: auto;
        hyphenate-limit-chars: 6 3 3;
        hyphenate-limit-lines: 2;
        hyphens: auto;
    }
}

/* Chrome/Blink optimizations */
@supports (font-feature-settings: "ss01") {
    .chat-input,
    .message {
        /* Enable stylistic alternates for better readability */
        font-feature-settings: "kern" 1, "liga" 1, "calt" 1, "ss01" 1;
    }
}

/* Firefox optimizations */
@supports (-moz-osx-font-smoothing: grayscale) {
    .chat-input,
    .message {
        -moz-osx-font-smoothing: grayscale;
        -moz-font-feature-settings: "kern" 1, "liga" 1;
    }
}

/* Accessibility Testing Helper Classes */
.a11y-test-font-size {
    /* Helper class for automated testing */
    font-size: var(--font-size-input);
    min-height: var(--min-touch-target);
}

.a11y-test-contrast {
    /* Helper class for contrast testing */
    color: var(--text-primary);
    background: var(--glass-bg-primary);
}

.a11y-test-focus {
    /* Helper class for focus testing */
    outline: 2px solid currentColor;
    outline-offset: 2px;
}

/* Performance Optimizations for Accessibility */
.chat-container.a11y-optimized {
    /* Reduce GPU usage for accessibility-focused rendering */
    will-change: auto;
    transform: none;

    /* Optimize text rendering */
    text-rendering: optimizeSpeed;
    font-display: block;
}

.chat-container.a11y-optimized .message,
.chat-container.a11y-optimized .chat-input {
    /* Stable font rendering for screen readers */
    will-change: auto;
    backface-visibility: visible;
    transform: none;
}